<!DOCTYPE html><html class="no-js" lang="zh-cn">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-5V25JL6');
    </script><link href="https://fonts.googleapis.com/css?family=Roboto&amp;display=swap" rel="stylesheet">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="twitter:card" content="summary">
<meta property="og:title" content="Shader variants - Unity 手册">
<title>Shader variants - Unity 手册</title>
<meta property="og:image" content="https://unity3d.com/files/images/ogimg.jpg">
<meta name="description" content="Shader variants, also sometimes called shader permutations, are one way of introducing conditional behavior into shader code.">
<meta property="og:description" content="Shader variants, also sometimes called shader permutations, are one way of introducing conditional behavior into shader code.">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="https://unity.com/themes/contrib/unity_base/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFiles/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFiles/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFiles/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFiles/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFiles/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFiles/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFiles/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFiles/images/favicons/tileicon-144x144.png">
<script type="text/javascript" src="" charset="UTF-8" data-domain-script="6e91be4c-3145-4ea2-aa64-89d716064836"></script><script type="text/javascript">
        function OptanonWrapper() { }
    </script><script>
      var docs_type = 'Manual';
      var lang = 'cn';
      var page = 'shader-variants';
      if(!page) page = 'index';
      var version = '2021.3';
      var docs_versions = [{version: '2022.1',version_string: '2022.1',supported: true},{version: '2021.3',version_string: '2021.3',supported: true},{version: '2021.2',version_string: '2021.2',supported: false},{version: '2021.1',version_string: '2021.1',supported: false},{version: '2020.3',version_string: '2020.3',supported: true},{version: '2020.2',version_string: '2020.2',supported: false},{version: '2020.1',version_string: '2020.1',supported: false},{version: '2019.4',version_string: '2019.4',supported: true},{version: '2019.3',version_string: '2019.3',supported: false},{version: '2019.2',version_string: '2019.2',supported: false},{version: '2019.1',version_string: '2019.1',supported: false},{version: '2018.4',version_string: '2018.4',supported: false},{version: '2018.3',version_string: '2018.3',supported: false},{version: '2018.2',version_string: '2018.2',supported: false},{version: '2018.1',version_string: '2018.1',supported: false},{version: '2017.4',version_string: '2017.4',supported: false},{version: '2017.3',version_string: '2017.3',supported: false},{version: '2017.2',version_string: '2017.2',supported: false},{version: '2017.1',version_string: '2017.1',supported: false},{version: '5.6',version_string: '560',supported: false},];</script><script type="text/javascript" src="../StaticFiles/js/jquery.js"></script><script type="text/javascript" src="../StaticFiles/js/core.js"></script><script type="text/javascript" src="../StaticFiles/js/jquery.sidebar.min.js"></script><script type="text/javascript" src="docdata/toc.js"></script><script type="text/javascript" src=""></script><script type="text/javascript" src="../StaticFiles/js/custom.js"></script><link rel="stylesheet" type="text/css" href="../StaticFiles/css/core.css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/custom.css">
<link rel="canonical" href="https://docs.unity3d.com/cn/2021.3/Manual/shader-variants.html">
<link rel="alternate" href="https://docs.unity3d.com/en/2021.3/Manual/shader-variants.html" hreflang="en">
<link rel="alternate" href="https://docs.unity3d.com/cn/2021.3/Manual/shader-variants.html" hreflang="zh">
<link rel="alternate" href="https://docs.unity3d.com/ja/2021.3/Manual/shader-variants.html" hreflang="ja">
<link rel="alternate" href="https://docs.unity3d.com/es/2021.3/Manual/shader-variants.html" hreflang="es">
<link rel="alternate" href="https://docs.unity3d.com/kr/2021.3/Manual/shader-variants.html" hreflang="ko">
<link rel="alternate" href="https://docs.unity3d.com/ru/2021.3/Manual/shader-variants.html" hreflang="ru">
<link rel="alternate" href="https://docs.unity3d.com/2021.3/Documentation/Manual/shader-variants.html" hreflang="x-default">
</head>
<body>
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5V25JL6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div id="nav-open" for="nav-input"><span></span></div>
<div class="logo"><a href="./index.html"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="搜索手册..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul class="menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="https://unity3d.com/">
                unity3d.com
              </a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2021.3</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2022.1" href="/cn/2022.1/Manual/shader-variants.html">2022.1</a></li>
<li class="supported"><a class="docs_version_url_2021.3" href="/cn/2021.3/Manual/shader-variants.html">2021.3</a></li>
<li class=""><a class="docs_version_url_2021.2" href="/cn/2021.2/Manual/shader-variants.html">2021.2</a></li>
<li class=""><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/shader-variants.html">2021.1</a></li>
<li class="supported"><a class="docs_version_url_2020.3" href="/cn/2020.3/Manual/shader-variants.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/shader-variants.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/shader-variants.html">2020.1</a></li>
<li class="supported"><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/shader-variants.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/shader-variants.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/shader-variants.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/shader-variants.html">2019.1</a></li>
<li class=""><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/shader-variants.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/shader-variants.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/shader-variants.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/shader-variants.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/shader-variants.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/shader-variants.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/shader-variants.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/shader-variants.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/shader-variants.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>包含此页的版本：</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>不含此页的版本：</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>受支持</li>
<li>
<div class="legacy-box"></div>旧版</li>
</ul>
</div>
</div>
<ul class="nav-menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
<div class="lang-switcher">
<div class="current toggle" data-target=".lang-list">
<div class="lbl">语言:
        <span class="b">中文</span>
</div>
<div class="arrow"></div>
</div>
<div class="lang-list" style="display:none;"><ul>
<li><a data-lang="en" href="/2021.3/Documentation/Manual/shader-variants.html">English</a></li>
<li><a data-lang="cn" href="/cn/2021.3/Manual/shader-variants.html">中文</a></li>
<li><a data-lang="ja" href="/ja/2021.3/Manual/shader-variants.html">日本語</a></li>
<li><a data-lang="es" href="/es/2021.3/Manual/shader-variants.html">Español</a></li>
<li><a data-lang="kr" href="/kr/2021.3/Manual/shader-variants.html">한국어</a></li>
<li><a data-lang="ru" href="/ru/2021.3/Manual/shader-variants.html">Русский</a></li>
</ul></div>
</div>
</div></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar hidden"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc">
<h2>手册</h2>
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2021.3</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2022.1" href="/cn/2022.1/Manual/shader-variants.html">2022.1</a></li>
<li class="supported"><a class="docs_version_url_2021.3" href="/cn/2021.3/Manual/shader-variants.html">2021.3</a></li>
<li class=""><a class="docs_version_url_2021.2" href="/cn/2021.2/Manual/shader-variants.html">2021.2</a></li>
<li class=""><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/shader-variants.html">2021.1</a></li>
<li class="supported"><a class="docs_version_url_2020.3" href="/cn/2020.3/Manual/shader-variants.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/shader-variants.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/shader-variants.html">2020.1</a></li>
<li class="supported"><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/shader-variants.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/shader-variants.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/shader-variants.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/shader-variants.html">2019.1</a></li>
<li class=""><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/shader-variants.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/shader-variants.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/shader-variants.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/shader-variants.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/shader-variants.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/shader-variants.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/shader-variants.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/shader-variants.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/shader-variants.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>包含此页的版本：</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>不含此页的版本：</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>受支持</li>
<li>
<div class="legacy-box"></div>旧版</li>
</ul>
</div>
</div>
<div class="clear"></div>
</div></div></div></div></div>
<div id="content-wrap" class="content-wrap opened-sidebar"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html">Unity User Manual 2021.3 (LTS)</a></li>
<li><a href="Graphics.html">图形</a></li>
<li><a href="Shaders.html">着色器</a></li>
<li><a href="ShadersOverview.html">着色器核心概念</a></li>
<li><a href="shader-variants-and-keywords.html">Branching, variants, and keywords</a></li>
<li>Shader variants</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="shader-branching.html"></a></span><div class="tip">Branching in shaders</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="shader-keywords.html"></a></span><div class="tip">Shader keywords</div>
</div>
</div></div>
<h1>Shader variants</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p>Shader variants, also sometimes called shader permutations, are one way of introducing <a href="shader-conditional-code">conditional behavior</a> into shader code.</p>

<p>Unity compiles shader source files into shader programs. Each compiled shader program has one or more <strong>variants</strong>: different versions of the shader program for different conditions. At runtime, Unity uses the variant that matches the current requirements. You configure variants using <a href="shader-keywords.html">shader keywords</a>.</p>

<p>For a general overview of conditionals in shader code and when to use which technique, see <a href="shader-conditionals.html">Conditionals in shader code</a>. For more information on how Unity loads shader variants, see <a href="shader-loading.html">Shader loading</a>.</p>

<p>具有大量变体的着色器被称为“大型着色器”或“超级着色器”。Unity 的标准着色器就是此类着色器的一个示例。</p>

<h2>Advantages and disadvantages of shader variants</h2>

<p>The main advantage of shader variants is that they allow you to use runtime conditionals in your shader programs, without the GPU performance impact of <a href="shader-branching.html#dynamic">dynamic branching</a>. The main disadvantage of shader variants is that a large number of them can lead to both build time and runtime performance issues.</p>

<p>When Unity creates shader variants, it uses <a href="shader-branching.html#static-branching">static branching</a> to create multiple small, specialized shader programs. At runtime, Unity uses the shader program that matches the conditions. This means that you can use shader variants for code that would likely result in reduced GPU performance in a dynamic branch, without suffering a GPU performance penalty.</p>

<p>However, a large number of variants can result in increased build times, file sizes, runtime memory usage, and loading times. It also leads to greater complexity when manually preloading (“prewarming”) shaders. When a project contains a very large number of shader variants, these issues can lead to significant problems with performance and workflow.</p>

<p><strong>Warning:</strong> It is easy to inadvertently create an excessively large number of shader variants, which can lead to significant performance problems. It is therefore very important to understand <a href="#number-shader-variants">how Unity determines the number of shader variants</a>, <a href="shader-variant-stripping.html">how to exclude (“strip”) unneeded variants from compilation</a>, and <a href="shader-conditionals.html">when to use other types of conditionals in shaders</a>.</p>

<p><a name="number-shader-variants"></a></p>

<h2>Number of shader variants</h2>

<p>At build time, Unity compiles one set of shader variants for each graphics API for the current build target. The number of variants for each combination of graphics API and build target depends on your shader source files, and your use of shader keywords.</p>

<h3>图形 API</h3>

<p>Unity compiles one set of shader variants for each graphics API in the list for the current build target. The shaders differ for each combination of build target and graphics API; for example, Unity compiles different shaders for Metal on iOS than for Metal on macOS.</p>

<p>Some shader programs or keywords might only target a given graphics API or a given build target, so the total number of variants for each combination of graphics API and build target can differ; however, the process for compiling these variants is the same.</p>

<p>To view and edit the list of graphics APIs for your current build target, use the <a href="class-PlayerSettings.html">Player Settings</a> window, or the <a href="../ScriptReference/PlayerSettings.html">PlayerSettings</a> API.</p>

<h3>Number of shader programs</h3>

<p>Unity must determine how many shader programs to compile for the current combination of build target and graphics API.</p>

<p>For each shader source file that is included in your build, Unity determines how many unique shader programs it defines:</p>

<ul>
<li>A compute shader asset defines a single shader program.</li>
<li>In a hand-coded shader, the number of shader programs depends on your code. The total comprises:

<ul>
<li>All shader stages in all Passes in the source file itself. For example, each vertex stage defines one shader program; each fragment stage defines one shader program; and so on.</li>
<li>All shader stages in all Passes in dependencies of the source file. This comprises all <a href="SL-Fallback.html">fallback shaders</a>, and all Passes that are included using the <a href="SL-UsePass.html">UsePass command</a>.</li>
</ul>
</li>
<li>In a Shader Graph shader, the number of shader programs depends on the code that Unity generates from your graph. To see the shader code that Unity generates, context-click the Shader Graph asset and select <strong>See generated code</strong>. You can then determine the total number of shader programs in the same way that you would for a hand-coded shader.</li>
</ul>

<p><strong>Note:</strong> A shader source file is included in a build if it is referenced in a scene in that build, referenced by something in the <strong>Resources</strong> folder, or included in the <strong>Always-included shaders</strong> section of the <a href="class-GraphicsSettings.html">Graphics Settings</a> window.</p>

<h3>Keywords that affect a shader program</h3>

<p>When Unity has determined how many shader programs it must compile for the current build target and graphics API, it then determines how many shader variants it must compile for each shader program.</p>

<p>For each shader program, Unity determines the combination of shader keywords that result in different variants. This comprises:</p>

<ul>
<li>The sets of shader variant keywords that are declared in the source file for that shader. For more information, see <a href="shader-keywords.html#declaring-keywords">Declaring shader keywords</a>.</li>
<li>The sets of shader keywords that Unity adds automatically. For more information, see <a href="shader-keywords.html#predefined-shader-keywords">Unity’s predefined shader keywords</a>.</li>
</ul>

<p>The number of shader variants that Unity compiles for a shader program is the product of the keyword sets; that is to say, Unity compiles one variant for every combination that includes one element from each set. </p>

<p>For example, this set contains three shader variant keywords:</p>

<ul>
<li>COLOR_RED</li>
<li>COLOR_GREEN</li>
<li>COLOR_BLUE</li>
</ul>

<p>This set contains four shader variant keywords:</p>

<ul>
<li>QUALITY_LOW</li>
<li>QUALITY_MEDIUM</li>
<li>QUALITY_HIGH</li>
<li>QUALITY_ULTRA</li>
</ul>

<p>A shader program affected by those shader variant keywords will result in the following twelve variants:</p>

<ul>
<li>COLOR_RED and QUALITY_LOW</li>
<li>COLOR_RED and QUALITY_MEDIUM</li>
<li>COLOR_RED and QUALITY_HIGH</li>
<li>COLOR_RED and QUALITY_ULTRA</li>
<li>COLOR_GREEN and QUALITY_LOW</li>
<li>COLOR_GREEN and QUALITY_MEDIUM</li>
<li>COLOR_GREEN and QUALITY_HIGH</li>
<li>COLOR_GREEN and QUALITY_ULTRA</li>
<li>COLOR_BLUE and QUALITY_LOW</li>
<li>COLOR_BLUE and QUALITY_MEDIUM</li>
<li>COLOR_BLUE and QUALITY_HIGH</li>
<li>COLOR_BLUE and QUALITY_ULTRA</li>
</ul>

<p>The number of variants that Unity compiles can grow very rapidly as you add more sets of shader variant keywords. The term for this very rapid growth is combinatorial explosion.</p>

<p>For example, consider a fairly typical use case, where a shader has a number of sets of shader variant keywords that contain two keywords each (<code>&lt;feature name&gt;_ON</code> and <code>&lt;feature name&gt;_OFF</code>). If the shader has two such sets of keywords, this results in four variants. If the shader has ten such sets of keywords, this results in 1024 variants.</p>

<p><a name="deduplication"></a></p>

<h3>Deduplication of shader variants</h3>

<p>After compilation, Unity automatically identifies identical variants within the same Pass, and ensures that these identical variants point to the same bytecode. This is called <strong>deduplication</strong>.</p>

<p>Deduplication prevents identical variants in the same Pass from increasing file size; however, identical variants still result in wasted work during compilation, and increased memory usage and shader loading times at runtime. With this in mind, it is always best to <a href="shader-variant-stripping.html">strip unneeded variants</a>.</p>
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="shader-branching.html"></a></span><div class="tip">Branching in shaders</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="shader-keywords.html"></a></span><div class="tip">Shader keywords</div>
</div>
</div>
</div>
<div class="footer-wrapper">
<div class="footer clear">
<div class="copy">Copyright © 2022 Unity Technologies. Publication 2021.3</div>
<div class="menu">
<a href="https://learn.unity.com/">教程</a><a href="https://answers.unity3d.com">社区答案</a><a href="https://support.unity3d.com/hc/en-us">知识库</a><a href="https://forum.unity3d.com">论坛</a><a href="https://unity3d.com/asset-store">Asset Store</a>
</div>
</div>
<div></div>
</div>
</div></div></div>
</div>
</body>
</html>
