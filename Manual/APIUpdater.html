<!DOCTYPE html><html class="no-js" lang="zh-cn">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-5V25JL6');
    </script><link href="https://fonts.googleapis.com/css?family=Roboto&amp;display=swap" rel="stylesheet">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="twitter:card" content="summary">
<meta property="og:title" content="API updater - Unity 手册">
<title>API updater - Unity 手册</title>
<meta property="og:image" content="https://unity3d.com/files/images/ogimg.jpg">
<meta name="description" content="To improve usability and performance, Unity might change the way classes, functions and properties (the API) work. Occasionally, these improvements might introduce breaking changes when moving from one major Unity version to another.">
<meta property="og:description" content="To improve usability and performance, Unity might change the way classes, functions and properties (the API) work. Occasionally, these improvements might introduce breaking changes when moving from one major Unity version to another.">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="https://unity.com/themes/contrib/unity_base/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFiles/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFiles/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFiles/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFiles/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFiles/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFiles/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFiles/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFiles/images/favicons/tileicon-144x144.png">
<script type="text/javascript" src="" charset="UTF-8" data-domain-script="6e91be4c-3145-4ea2-aa64-89d716064836"></script><script type="text/javascript">
        function OptanonWrapper() { }
    </script><script>
      var docs_type = 'Manual';
      var lang = 'cn';
      var page = 'APIUpdater';
      if(!page) page = 'index';
      var version = '2021.3';
      var docs_versions = [{version: '2022.1',version_string: '2022.1',supported: true},{version: '2021.3',version_string: '2021.3',supported: true},{version: '2021.2',version_string: '2021.2',supported: false},{version: '2021.1',version_string: '2021.1',supported: false},{version: '2020.3',version_string: '2020.3',supported: true},{version: '2020.2',version_string: '2020.2',supported: false},{version: '2020.1',version_string: '2020.1',supported: false},{version: '2019.4',version_string: '2019.4',supported: true},{version: '2019.3',version_string: '2019.3',supported: false},{version: '2019.2',version_string: '2019.2',supported: false},{version: '2019.1',version_string: '2019.1',supported: false},{version: '2018.4',version_string: '2018.4',supported: false},{version: '2018.3',version_string: '2018.3',supported: false},{version: '2018.2',version_string: '2018.2',supported: false},{version: '2018.1',version_string: '2018.1',supported: false},{version: '2017.4',version_string: '2017.4',supported: false},{version: '2017.3',version_string: '2017.3',supported: false},{version: '2017.2',version_string: '2017.2',supported: false},{version: '2017.1',version_string: '2017.1',supported: false},{version: '5.6',version_string: '560',supported: false},];</script><script type="text/javascript" src="../StaticFiles/js/jquery.js"></script><script type="text/javascript" src="../StaticFiles/js/core.js"></script><script type="text/javascript" src="../StaticFiles/js/jquery.sidebar.min.js"></script><script type="text/javascript" src="docdata/toc.js"></script><script type="text/javascript" src=""></script><script type="text/javascript" src="../StaticFiles/js/custom.js"></script><link rel="stylesheet" type="text/css" href="../StaticFiles/css/core.css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/custom.css">
<link rel="canonical" href="https://docs.unity3d.com/cn/2021.3/Manual/APIUpdater.html">
<link rel="alternate" href="https://docs.unity3d.com/en/2021.3/Manual/APIUpdater.html" hreflang="en">
<link rel="alternate" href="https://docs.unity3d.com/cn/2021.3/Manual/APIUpdater.html" hreflang="zh">
<link rel="alternate" href="https://docs.unity3d.com/ja/2021.3/Manual/APIUpdater.html" hreflang="ja">
<link rel="alternate" href="https://docs.unity3d.com/es/2021.3/Manual/APIUpdater.html" hreflang="es">
<link rel="alternate" href="https://docs.unity3d.com/kr/2021.3/Manual/APIUpdater.html" hreflang="ko">
<link rel="alternate" href="https://docs.unity3d.com/ru/2021.3/Manual/APIUpdater.html" hreflang="ru">
<link rel="alternate" href="https://docs.unity3d.com/2021.3/Documentation/Manual/APIUpdater.html" hreflang="x-default">
</head>
<body>
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5V25JL6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div id="nav-open" for="nav-input"><span></span></div>
<div class="logo"><a href="./index.html"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="搜索手册..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul class="menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="https://unity3d.com/">
                unity3d.com
              </a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2021.3</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2022.1" href="/cn/2022.1/Manual/APIUpdater.html">2022.1</a></li>
<li class="supported"><a class="docs_version_url_2021.3" href="/cn/2021.3/Manual/APIUpdater.html">2021.3</a></li>
<li class=""><a class="docs_version_url_2021.2" href="/cn/2021.2/Manual/APIUpdater.html">2021.2</a></li>
<li class=""><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/APIUpdater.html">2021.1</a></li>
<li class="supported"><a class="docs_version_url_2020.3" href="/cn/2020.3/Manual/APIUpdater.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/APIUpdater.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/APIUpdater.html">2020.1</a></li>
<li class="supported"><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/APIUpdater.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/APIUpdater.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/APIUpdater.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/APIUpdater.html">2019.1</a></li>
<li class=""><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/APIUpdater.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/APIUpdater.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/APIUpdater.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/APIUpdater.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/APIUpdater.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/APIUpdater.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/APIUpdater.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/APIUpdater.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/APIUpdater.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>包含此页的版本：</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>不含此页的版本：</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>受支持</li>
<li>
<div class="legacy-box"></div>旧版</li>
</ul>
</div>
</div>
<ul class="nav-menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
<div class="lang-switcher">
<div class="current toggle" data-target=".lang-list">
<div class="lbl">语言:
        <span class="b">中文</span>
</div>
<div class="arrow"></div>
</div>
<div class="lang-list" style="display:none;"><ul>
<li><a data-lang="en" href="/2021.3/Documentation/Manual/APIUpdater.html">English</a></li>
<li><a data-lang="cn" href="/cn/2021.3/Manual/APIUpdater.html">中文</a></li>
<li><a data-lang="ja" href="/ja/2021.3/Manual/APIUpdater.html">日本語</a></li>
<li><a data-lang="es" href="/es/2021.3/Manual/APIUpdater.html">Español</a></li>
<li><a data-lang="kr" href="/kr/2021.3/Manual/APIUpdater.html">한국어</a></li>
<li><a data-lang="ru" href="/ru/2021.3/Manual/APIUpdater.html">Русский</a></li>
</ul></div>
</div>
</div></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar hidden"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc">
<h2>手册</h2>
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2021.3</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2022.1" href="/cn/2022.1/Manual/APIUpdater.html">2022.1</a></li>
<li class="supported"><a class="docs_version_url_2021.3" href="/cn/2021.3/Manual/APIUpdater.html">2021.3</a></li>
<li class=""><a class="docs_version_url_2021.2" href="/cn/2021.2/Manual/APIUpdater.html">2021.2</a></li>
<li class=""><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/APIUpdater.html">2021.1</a></li>
<li class="supported"><a class="docs_version_url_2020.3" href="/cn/2020.3/Manual/APIUpdater.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/APIUpdater.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/APIUpdater.html">2020.1</a></li>
<li class="supported"><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/APIUpdater.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/APIUpdater.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/APIUpdater.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/APIUpdater.html">2019.1</a></li>
<li class=""><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/APIUpdater.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/APIUpdater.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/APIUpdater.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/APIUpdater.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/APIUpdater.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/APIUpdater.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/APIUpdater.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/APIUpdater.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/APIUpdater.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>包含此页的版本：</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>不含此页的版本：</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>受支持</li>
<li>
<div class="legacy-box"></div>旧版</li>
</ul>
</div>
</div>
<div class="clear"></div>
</div></div></div></div></div>
<div id="content-wrap" class="content-wrap opened-sidebar"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html">Unity User Manual 2021.3 (LTS)</a></li>
<li><a href="UnityOverview.html">在 Unity 中操作</a></li>
<li><a href="UpgradeGuides.html">升级 Unity</a></li>
<li>API updater</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="UpgradeGuides.html"></a></span><div class="tip">升级 Unity</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="UpgradeGuide2021LTS.html"></a></span><div class="tip">Upgrading to Unity 2021 LTS</div>
</div>
</div></div>
<h1>API updater</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p>To improve usability and performance, Unity might change the way classes, functions and properties (the API) work. Occasionally, these improvements might introduce breaking changes when moving from one major Unity version to another. </p>

<p>To minimize the impact of breaking changes, the API updater identifies and updates obsolete code in your scripts and assemblies.</p>

<p>The API updater consists of the ScriptUpdater and the AssemblyUpdater, which are responsible for updating source code (scripts) and assemblies (dll files) respectively.</p>

<p><strong>Note</strong>: The API Updater can only fix certain errors and warnings in the API. These are indicated as <strong>UnityUpgradable</strong> in the console message. You must manually resolve other errors or warnings that the API Updater cannot handle.</p>

<h2>Using the API updater</h2>

<p>When a <a href="script-compilation.html">script compilation</a> is triggered, the API updater runs automatically. For example, this occurs when you:</p>

<ul>
<li>Open a project.</li>
<li>Import a package.</li>
<li>Save changes to a script.</li>
</ul>

<p>The API updater offers to update any obsolete code that it detects. If you accept, it rewrites any obsolete code with the recommended updated version of the API.</p>

<p>For example, the API updater would convert the following obsolete statement from:</p>

<pre><code>light.color = Color.red;
</code></pre>

<p>to:</p>

<pre><code>GetComponent&lt;Light&gt;().color = Color.red;
</code></pre>

<p>The steps below describe the workflow of the API updater when Unity triggers a script compilation:</p>

<ol>
<li>Unity triggers a script compilation.</li>
<li>The API updater checks for updatable compiler errors or warnings that it can handle.

<ul>
<li>If it doesn’t find any errors or warnings, the process ends.</li>
<li>If it finds any errors or warnings, it displays a dialog offering an automatic update.<br>Close the Editor and back up your project before you let the API updater update your scripts or assemblies. When you reopen your project, Unity compiles your scripts and triggers the API updater.</li>
</ul>
</li>
<li>If you accept the update, the API updater updates all scripts in the same compilation unit.</li>
<li>The API Updater repeats this process until it detects no more errors or warnings that it can handle.</li>
</ol>

<p>The updater can run multiple times if scripts with obsolete code fall into different compilation passes, for example, editor scripts.</p>

<p>If you don’t allow the API updater to update your scripts, the console displays any script errors or warnings. Errors or warnings which the API updater could resolve display (<strong>UnityUpgradable</strong>) in the message.</p>

<p>If your script has other errors which prevent the API updater from running successfully, the Console displays a message to inform you of this. You must resolve those errors before the API Updater can complete the updates.</p>

<h2>Command line arguments related to API Updater</h2>

<p>When running Unity in batch mode from the command line, use the <code>-accept-apiupdate</code> option to run the API updater. For more information, see <a href="CommandLineArguments.html">Command Line Arguments</a>.</p>

<h2>日志记录</h2>

<p>The API updater logs changes it makes to any assemblies to the <a href="LogFiles.html">Editor log</a>. To control how much information is logged, set the UNITY_APIUPDATER_LOG_THRESHOLD environment variable to the desired log threshold and start Unity. For example:</p>

<p>Windows：</p>

<pre><code>c:&gt; set UNITY_APIUPDATER_LOG_THRESHOLD=Debug
c:&gt; \path\to\unity\Unity.exe
</code></pre>

<p>On Linux:</p>

<pre><code>$ export UNITY_APIUPDATER_LOG_THRESHOLD=Debug
$ /path/to/unity/Unity
</code></pre>

<p>在 Mac 上：</p>

<pre><code>$ export UNITY_APIUPDATER_LOG_THRESHOLD=Debug
$ /path/to/unity/Unity
</code></pre>

<p><strong>Note</strong>: You can also use <a href="https://en.wikipedia.org/wiki/Version_control">version control</a> to see changes the API updater makes to a project’s scripts.</p>

<p>When AssemblyUpdater has finished, the Editor.log displays the changes. For example:</p>

<pre><code>[AssemblyUpdater] Property access to 'UnityEngine.Rigidbody
UnityEngine.GameObject::get_rigidbody()' in 'System.Void
Test.ClassReferencingObsoleteUnityAPIThroughEditorAssembly::Run()' replaced with 'T
UnityEngine.GameObject::GetComponent&lt;UnityEngine.Rigidbody&gt;()'.
</code></pre>

<p>The table below describes the values for the <code>UNITY_APIUPDATER_LOG_THRESHOLD</code> environment variable:</p>

<table>
<colgroup>
<col style="text-align:left;">
<col style="text-align:left;">
</colgroup>

<thead>
<tr>
	<th style="text-align:left;">Log threshold</th>
	<th style="text-align:left;">描述</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:left;">
<strong>Error</strong> (default value)</td>
	<td style="text-align:left;">The API updater only logs <strong>Error</strong> messages. Error messages are logged when the API updater fails to apply a specific update, which requires you to take corrective action (usually requesting the original assembly author to provide an updated version of the assembly).</td>
</tr>
<tr>
	<td style="text-align:left;"><strong>Warning</strong></td>
	<td style="text-align:left;">The API updater logs <strong>Warning</strong> and <strong>Error</strong> messages. Warning messages are logged when the API updater applies a change that the user might need to review.</td>
</tr>
<tr>
	<td style="text-align:left;"><strong>Info</strong></td>
	<td style="text-align:left;">The API updater logs <strong>Informational</strong>, <strong>Warning</strong> and <strong>Error</strong> messages. Info messages include updates applied by the AssemblyUpdater.</td>
</tr>
<tr>
	<td style="text-align:left;"><strong>Debug</strong></td>
	<td style="text-align:left;">The API updater logs all messages. This is useful for troubleshooting, for example if you have issues with the API updater that you want to report to Unity.</td>
</tr>
</tbody>
</table>

<h2>故障排除</h2>

<h3>API Updating failed. Check previous console messages.</h3>

<p>The API updater couldn’t update all obsolete code. This can occur if the updater can’t save its changes, for example if the user has read-only permissions on the script.</p>

<p>Check the previous lines in the console to see any problems that occurred during the update process.</p>

<ul>
<li><p><span class="page-edit">2018–07–31 页面已修订</span></p></li>
<li><p><span class="page-history">Unity 2017.2 中添加了“accept-apiupdate”命令行选项</span></p></li>
<li><p><span class="page-history">在 Unity <a href="https://docs.unity3d.com/2018.3/Documentation/Manual/30_search.html?q=newin20183">2018.3</a> 版本中改进了 AssemblyUpdater 日志记录 <span class="search-words">NewIn20183</span></span></p></li>
</ul>
<!-- area:none -->
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="UpgradeGuides.html"></a></span><div class="tip">升级 Unity</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="UpgradeGuide2021LTS.html"></a></span><div class="tip">Upgrading to Unity 2021 LTS</div>
</div>
</div>
</div>
<div class="footer-wrapper">
<div class="footer clear">
<div class="copy">Copyright © 2022 Unity Technologies. Publication 2021.3</div>
<div class="menu">
<a href="https://learn.unity.com/">教程</a><a href="https://answers.unity3d.com">社区答案</a><a href="https://support.unity3d.com/hc/en-us">知识库</a><a href="https://forum.unity3d.com">论坛</a><a href="https://unity3d.com/asset-store">Asset Store</a>
</div>
</div>
<div></div>
</div>
</div></div></div>
</div>
</body>
</html>
