<!DOCTYPE html><html class="no-js" lang="zh-cn">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-5V25JL6');
    </script><link href="https://fonts.googleapis.com/css?family=Roboto&amp;display=swap" rel="stylesheet">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="twitter:card" content="summary">
<meta property="og:title" content="WebGL 中的内存 - Unity 手册">
<title>WebGL 中的内存 - Unity 手册</title>
<meta property="og:image" content="https://unity3d.com/files/images/ogimg.jpg">
<meta name="description" content="Unity WebGL 中的内存限制可能会限制可以运行的内容的复杂性。">
<meta property="og:description" content="Unity WebGL 中的内存限制可能会限制可以运行的内容的复杂性。">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="https://unity.com/themes/contrib/unity_base/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFiles/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFiles/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFiles/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFiles/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFiles/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFiles/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFiles/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFiles/images/favicons/tileicon-144x144.png">
<script type="text/javascript" src="" charset="UTF-8" data-domain-script="6e91be4c-3145-4ea2-aa64-89d716064836"></script><script type="text/javascript">
        function OptanonWrapper() { }
    </script><script>
      var docs_type = 'Manual';
      var lang = 'cn';
      var page = 'webgl-memory';
      if(!page) page = 'index';
      var version = '2021.3';
      var docs_versions = [{version: '2022.1',version_string: '2022.1',supported: true},{version: '2021.3',version_string: '2021.3',supported: true},{version: '2021.2',version_string: '2021.2',supported: false},{version: '2021.1',version_string: '2021.1',supported: false},{version: '2020.3',version_string: '2020.3',supported: true},{version: '2020.2',version_string: '2020.2',supported: false},{version: '2020.1',version_string: '2020.1',supported: false},{version: '2019.4',version_string: '2019.4',supported: true},{version: '2019.3',version_string: '2019.3',supported: false},{version: '2019.2',version_string: '2019.2',supported: false},{version: '2019.1',version_string: '2019.1',supported: false},{version: '2018.4',version_string: '2018.4',supported: false},{version: '2018.3',version_string: '2018.3',supported: false},{version: '2018.2',version_string: '2018.2',supported: false},{version: '2018.1',version_string: '2018.1',supported: false},{version: '2017.4',version_string: '2017.4',supported: false},{version: '2017.3',version_string: '2017.3',supported: false},{version: '2017.2',version_string: '2017.2',supported: false},{version: '2017.1',version_string: '2017.1',supported: false},{version: '5.6',version_string: '560',supported: false},];</script><script type="text/javascript" src="../StaticFiles/js/jquery.js"></script><script type="text/javascript" src="../StaticFiles/js/core.js"></script><script type="text/javascript" src="../StaticFiles/js/jquery.sidebar.min.js"></script><script type="text/javascript" src="docdata/toc.js"></script><script type="text/javascript" src=""></script><script type="text/javascript" src="../StaticFiles/js/custom.js"></script><link rel="stylesheet" type="text/css" href="../StaticFiles/css/core.css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/custom.css">
<link rel="canonical" href="https://docs.unity3d.com/cn/2021.3/Manual/webgl-memory.html">
<link rel="alternate" href="https://docs.unity3d.com/en/2021.3/Manual/webgl-memory.html" hreflang="en">
<link rel="alternate" href="https://docs.unity3d.com/cn/2021.3/Manual/webgl-memory.html" hreflang="zh">
<link rel="alternate" href="https://docs.unity3d.com/ja/2021.3/Manual/webgl-memory.html" hreflang="ja">
<link rel="alternate" href="https://docs.unity3d.com/es/2021.3/Manual/webgl-memory.html" hreflang="es">
<link rel="alternate" href="https://docs.unity3d.com/kr/2021.3/Manual/webgl-memory.html" hreflang="ko">
<link rel="alternate" href="https://docs.unity3d.com/ru/2021.3/Manual/webgl-memory.html" hreflang="ru">
<link rel="alternate" href="https://docs.unity3d.com/2021.3/Documentation/Manual/webgl-memory.html" hreflang="x-default">
</head>
<body>
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5V25JL6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div id="nav-open" for="nav-input"><span></span></div>
<div class="logo"><a href="./index.html"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="搜索手册..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul class="menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="https://unity3d.com/">
                unity3d.com
              </a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2021.3</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2022.1" href="/cn/2022.1/Manual/webgl-memory.html">2022.1</a></li>
<li class="supported"><a class="docs_version_url_2021.3" href="/cn/2021.3/Manual/webgl-memory.html">2021.3</a></li>
<li class=""><a class="docs_version_url_2021.2" href="/cn/2021.2/Manual/webgl-memory.html">2021.2</a></li>
<li class=""><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/webgl-memory.html">2021.1</a></li>
<li class="supported"><a class="docs_version_url_2020.3" href="/cn/2020.3/Manual/webgl-memory.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/webgl-memory.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/webgl-memory.html">2020.1</a></li>
<li class="supported"><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/webgl-memory.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/webgl-memory.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/webgl-memory.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/webgl-memory.html">2019.1</a></li>
<li class=""><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/webgl-memory.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/webgl-memory.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/webgl-memory.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/webgl-memory.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/webgl-memory.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/webgl-memory.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/webgl-memory.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/webgl-memory.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/webgl-memory.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>包含此页的版本：</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>不含此页的版本：</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>受支持</li>
<li>
<div class="legacy-box"></div>旧版</li>
</ul>
</div>
</div>
<ul class="nav-menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
<div class="lang-switcher">
<div class="current toggle" data-target=".lang-list">
<div class="lbl">语言:
        <span class="b">中文</span>
</div>
<div class="arrow"></div>
</div>
<div class="lang-list" style="display:none;"><ul>
<li><a data-lang="en" href="/2021.3/Documentation/Manual/webgl-memory.html">English</a></li>
<li><a data-lang="cn" href="/cn/2021.3/Manual/webgl-memory.html">中文</a></li>
<li><a data-lang="ja" href="/ja/2021.3/Manual/webgl-memory.html">日本語</a></li>
<li><a data-lang="es" href="/es/2021.3/Manual/webgl-memory.html">Español</a></li>
<li><a data-lang="kr" href="/kr/2021.3/Manual/webgl-memory.html">한국어</a></li>
<li><a data-lang="ru" href="/ru/2021.3/Manual/webgl-memory.html">Русский</a></li>
</ul></div>
</div>
</div></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar hidden"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc">
<h2>手册</h2>
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2021.3</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2022.1" href="/cn/2022.1/Manual/webgl-memory.html">2022.1</a></li>
<li class="supported"><a class="docs_version_url_2021.3" href="/cn/2021.3/Manual/webgl-memory.html">2021.3</a></li>
<li class=""><a class="docs_version_url_2021.2" href="/cn/2021.2/Manual/webgl-memory.html">2021.2</a></li>
<li class=""><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/webgl-memory.html">2021.1</a></li>
<li class="supported"><a class="docs_version_url_2020.3" href="/cn/2020.3/Manual/webgl-memory.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/webgl-memory.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/webgl-memory.html">2020.1</a></li>
<li class="supported"><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/webgl-memory.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/webgl-memory.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/webgl-memory.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/webgl-memory.html">2019.1</a></li>
<li class=""><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/webgl-memory.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/webgl-memory.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/webgl-memory.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/webgl-memory.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/webgl-memory.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/webgl-memory.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/webgl-memory.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/webgl-memory.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/webgl-memory.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>包含此页的版本：</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>不含此页的版本：</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>受支持</li>
<li>
<div class="legacy-box"></div>旧版</li>
</ul>
</div>
</div>
<div class="clear"></div>
</div></div></div></div></div>
<div id="content-wrap" class="content-wrap opened-sidebar"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html">Unity User Manual 2021.3 (LTS)</a></li>
<li><a href="PlatformSpecific.html">平台开发</a></li>
<li><a href="webgl.html">WebGL</a></li>
<li><a href="webgl-develop.html">Developing for WebGL</a></li>
<li>WebGL 中的内存</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="webgl-develop.html"></a></span><div class="tip">Developing for WebGL</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="webgl-interactingwithbrowserscripting.html"></a></span><div class="tip">Interaction with browser scripting</div>
</div>
</div></div>
<h1>WebGL 中的内存</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p>Unity WebGL 中的内存限制可能会限制可以运行的内容的复杂性。</p>

<p>WebGL 内容在浏览器中运行。浏览器在其内存空间中分配应用程序运行内容所需的内存。
可用内存量因以下因素而异：</p>

<ul>
<li>使用的设备</li>
<li>使用的操作系统</li>
<li>使用的浏览器，以及是在 32 位还是 64 位处理器上运行</li>
<li>浏览器的 JavaScript 引擎解析代码所需的内存量</li>
<li>浏览器为每个选项卡使用单独进程，还是内容需要与所有其他打开的选项卡共享内存空间。</li>
</ul>

<p>Unity WebGL 内容在几个方面需要浏览器分配大量内存。</p>

<h2>Unity 堆</h2>

<p>Unity 使用内存堆存储所有 Unity 引擎运行时对象。这些包括托管和原生对象、加载的资源、场景和着色器。这类似于 Unity 播放器在其他平台上使用的内存。</p>

<p>Unity 堆是分配的连续内存块。Unity 支持自动调整堆大小以满足应用程序的需要。堆大小可随着应用程序运行而扩展，最多可以扩展到 2GB。Unity 将此内存堆创建为<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WebAssembly/Memory">内存对象</a>。内存对象的缓冲区属性是可调整大小的 ArrayBuffer，用于保存 WebAssembly 代码访问的内存的原始字节。</p>

<p>如果浏览器无法在地址空间中分配连续的内存块，则自动调整堆大小可能会导致应用程序崩溃。出于此原因，应使 Unity 堆大小尽可能小，这十分重要。因此，在规划应用程序的内存使用量时要谨慎。如果要测试 Unity 堆的大小，可以使用<a href="Profiler.html">性能分析器</a>对内存块的内容进行性能分析。</p>

<h2>资源数据</h2>

<p>创建 Unity WebGL 构建时，Unity 会生成一个 <code>.data</code> 文件。这包含应用程序需要启动的所有场景和资源。因为 Unity WebGL 无法访问实际文件系统，所以会创建虚拟内存文件系统，浏览器会在此处解压缩 <code>.data</code> 文件。Emscipten 框架 (JavaScript) 在浏览器内存空间中分配此内存文件系统。内容运行时，浏览器内存会保留未压缩的数据。为了缩短下载时间和降低内存使用量，应尽量保持未压缩数据尽可能小。</p>

<p>为了减少内存使用量，可以将资源数据打包到 AssetBundles 中。通过 AssetBundles 可以完全控制资源下载。这意味着可以控制应用程序何时下载资源，以及运行时何时卸载它。卸载未使用的资源可释放内存。</p>

<p>AssetBundles 直接下载到 Unity 堆中，因此这些内容不会导致浏览器进行额外分配。</p>

<p>启用<strong>数据缓存</strong>可将内容中的资源数据自动缓存在用户计算机上。这意味着无需在以后的运行过程中重新下载该数据。Unity WebGL 加载程序使用 IndexedDB API 实现数据缓存。此选项使您可以缓存对于浏览器而言太大而无法在本机缓存的文件。</p>

<p>数据缓存使浏览器能够将应用程序数据存储在用户的计算机上。浏览器通常会限制可以在其缓存中存储的量以及可以缓存的最大文件大小。这通常不足以使应用程序顺畅运行。因此，Unity WebGL 加载程序使用 IndexedDB API 实现数据缓存。Unity 会将数据存储在 IndexedDB 中，而不是将内容存储在浏览器缓存中。</p>

<p>要启用数据缓存选项，请转到 <strong>File</strong> &gt; <strong>Build Settings</strong> &gt; <strong>Player Settings</strong> &gt; <strong>Publishing Settings</strong>。</p>

<h2>Large-Allocation HTTP 标头</h2>

<p>您的服务器可为您的内容发出 <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Large-Allocation">Large-Allocation</a> HTTP 标头。这会向支持的浏览器（目前只有 Mozilla Firefox）告知您的内存需求。此信息使支持的浏览器可以使用未分段的内存空间生成新进程。浏览器还可以进行额外的内务处理以确保大型分配成功。
这可以解决浏览器在尝试分配 Unity 堆时内存不足的问题。这在 32 位浏览器上尤其重要。</p>

<p><a name="garbage"></a></p>

<h2>垃圾收集注意事项</h2>

<p>垃圾收集是查找和释放未使用内存的过程。一旦垃圾回收器收集了未使用的内存，它便会在 Unity 堆中重新分配这些内存。</p>

<p>For an overview on how Unity garbage collection works, see <a href="performance-managed-memory.html">Automatic Memory Management</a>. WebGL garbage collection runs when the stack is empty. The stack is a part of the Unity heap but not the heap itself. This usually occurs after every frame. This is different from the garbage collection process on other platforms, where the collector pauses all running threads so it can inspect the stack. This is not possible in JavaScript. You can debug the garbage collection process using the Unity <a href="Profiler.html">Profiler</a>.</p>

<p>在大多数其他平台上，垃圾收集会暂停所有正在运行的线程。垃圾回收器随后会检查其堆栈并注册加载的对象引用。目前在 JavaScript 中还无法实现这一点。因此，只有在堆栈为空的情况下，垃圾回收器才会在 WebGL 中运行。此操作当前在每一帧之后发生一次。</p>

<p>因此，以下代码将无法在 WebGL 上运行。这是因为回收器无法在循环的迭代之间运行垃圾回收器。这意味着垃圾回收器无法释放中间字符串对象使用的内存，可能会耗尽 Unity 堆中的内存。</p>

<pre><code>string hugeString = "";
 
for (int i = 0; i &lt; 100000; i++)
 
{
 
  hugeString += "foo";
 
}
</code></pre>

<hr>

<p><span class="page history"> 在 2020.1 中引入了更新的 WebGL 加载程序</span></p>
<!-- area:platforms -->
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="webgl-develop.html"></a></span><div class="tip">Developing for WebGL</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="webgl-interactingwithbrowserscripting.html"></a></span><div class="tip">Interaction with browser scripting</div>
</div>
</div>
</div>
<div class="footer-wrapper">
<div class="footer clear">
<div class="copy">Copyright © 2022 Unity Technologies. Publication 2021.3</div>
<div class="menu">
<a href="https://learn.unity.com/">教程</a><a href="https://answers.unity3d.com">社区答案</a><a href="https://support.unity3d.com/hc/en-us">知识库</a><a href="https://forum.unity3d.com">论坛</a><a href="https://unity3d.com/asset-store">Asset Store</a>
</div>
</div>
<div></div>
</div>
</div></div></div>
</div>
</body>
</html>
