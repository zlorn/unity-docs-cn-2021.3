<!DOCTYPE html><html class="no-js" lang="zh-cn">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-5V25JL6');
    </script><link href="https://fonts.googleapis.com/css?family=Roboto&amp;display=swap" rel="stylesheet">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="twitter:card" content="summary">
<meta property="og:title" content="Scriptable Render Pipeline Batcher - Unity 手册">
<title>Scriptable Render Pipeline Batcher - Unity 手册</title>
<meta property="og:image" content="https://docs.unity3d.com/cn/2021.3/uploads/Main/SRPBatcher.png">
<meta name="description" content="The Scriptable Render Pipeline (SRP) Batcher is a draw call optimization that significantly improves performance for applications that use an SRP. The SRP Batcher reduces the CPU time Unity requires to prepare and dispatch draw calls for materials that use the same shader variant.">
<meta property="og:description" content="The Scriptable Render Pipeline (SRP) Batcher is a draw call optimization that significantly improves performance for applications that use an SRP. The SRP Batcher reduces the CPU time Unity requires to prepare and dispatch draw calls for materials that use the same shader variant.">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="https://unity.com/themes/contrib/unity_base/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFiles/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFiles/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFiles/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFiles/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFiles/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFiles/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFiles/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFiles/images/favicons/tileicon-144x144.png">
<script type="text/javascript" src="" charset="UTF-8" data-domain-script="6e91be4c-3145-4ea2-aa64-89d716064836"></script><script type="text/javascript">
        function OptanonWrapper() { }
    </script><script>
      var docs_type = 'Manual';
      var lang = 'cn';
      var page = 'SRPBatcher';
      if(!page) page = 'index';
      var version = '2021.3';
      var docs_versions = [{version: '2022.1',version_string: '2022.1',supported: true},{version: '2021.3',version_string: '2021.3',supported: true},{version: '2021.2',version_string: '2021.2',supported: false},{version: '2021.1',version_string: '2021.1',supported: false},{version: '2020.3',version_string: '2020.3',supported: true},{version: '2020.2',version_string: '2020.2',supported: false},{version: '2020.1',version_string: '2020.1',supported: false},{version: '2019.4',version_string: '2019.4',supported: true},{version: '2019.3',version_string: '2019.3',supported: false},{version: '2019.2',version_string: '2019.2',supported: false},{version: '2019.1',version_string: '2019.1',supported: false},{version: '2018.4',version_string: '2018.4',supported: false},{version: '2018.3',version_string: '2018.3',supported: false},{version: '2018.2',version_string: '2018.2',supported: false},{version: '2018.1',version_string: '2018.1',supported: false},{version: '2017.4',version_string: '2017.4',supported: false},{version: '2017.3',version_string: '2017.3',supported: false},{version: '2017.2',version_string: '2017.2',supported: false},{version: '2017.1',version_string: '2017.1',supported: false},{version: '5.6',version_string: '560',supported: false},];</script><script type="text/javascript" src="../StaticFiles/js/jquery.js"></script><script type="text/javascript" src="../StaticFiles/js/core.js"></script><script type="text/javascript" src="../StaticFiles/js/jquery.sidebar.min.js"></script><script type="text/javascript" src="docdata/toc.js"></script><script type="text/javascript" src=""></script><script type="text/javascript" src="../StaticFiles/js/custom.js"></script><link rel="stylesheet" type="text/css" href="../StaticFiles/css/core.css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/custom.css">
<link rel="canonical" href="https://docs.unity3d.com/cn/2021.3/Manual/SRPBatcher.html">
<link rel="alternate" href="https://docs.unity3d.com/en/2021.3/Manual/SRPBatcher.html" hreflang="en">
<link rel="alternate" href="https://docs.unity3d.com/cn/2021.3/Manual/SRPBatcher.html" hreflang="zh">
<link rel="alternate" href="https://docs.unity3d.com/ja/2021.3/Manual/SRPBatcher.html" hreflang="ja">
<link rel="alternate" href="https://docs.unity3d.com/es/2021.3/Manual/SRPBatcher.html" hreflang="es">
<link rel="alternate" href="https://docs.unity3d.com/kr/2021.3/Manual/SRPBatcher.html" hreflang="ko">
<link rel="alternate" href="https://docs.unity3d.com/ru/2021.3/Manual/SRPBatcher.html" hreflang="ru">
<link rel="alternate" href="https://docs.unity3d.com/2021.3/Documentation/Manual/SRPBatcher.html" hreflang="x-default">
</head>
<body>
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5V25JL6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div id="nav-open" for="nav-input"><span></span></div>
<div class="logo"><a href="./index.html"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="搜索手册..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul class="menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="https://unity3d.com/">
                unity3d.com
              </a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2021.3</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2022.1" href="/cn/2022.1/Manual/SRPBatcher.html">2022.1</a></li>
<li class="supported"><a class="docs_version_url_2021.3" href="/cn/2021.3/Manual/SRPBatcher.html">2021.3</a></li>
<li class=""><a class="docs_version_url_2021.2" href="/cn/2021.2/Manual/SRPBatcher.html">2021.2</a></li>
<li class=""><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/SRPBatcher.html">2021.1</a></li>
<li class="supported"><a class="docs_version_url_2020.3" href="/cn/2020.3/Manual/SRPBatcher.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/SRPBatcher.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/SRPBatcher.html">2020.1</a></li>
<li class="supported"><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/SRPBatcher.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/SRPBatcher.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/SRPBatcher.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/SRPBatcher.html">2019.1</a></li>
<li class=""><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/SRPBatcher.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/SRPBatcher.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/SRPBatcher.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/SRPBatcher.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/SRPBatcher.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/SRPBatcher.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/SRPBatcher.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/SRPBatcher.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/SRPBatcher.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>包含此页的版本：</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>不含此页的版本：</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>受支持</li>
<li>
<div class="legacy-box"></div>旧版</li>
</ul>
</div>
</div>
<ul class="nav-menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
<div class="lang-switcher">
<div class="current toggle" data-target=".lang-list">
<div class="lbl">语言:
        <span class="b">中文</span>
</div>
<div class="arrow"></div>
</div>
<div class="lang-list" style="display:none;"><ul>
<li><a data-lang="en" href="/2021.3/Documentation/Manual/SRPBatcher.html">English</a></li>
<li><a data-lang="cn" href="/cn/2021.3/Manual/SRPBatcher.html">中文</a></li>
<li><a data-lang="ja" href="/ja/2021.3/Manual/SRPBatcher.html">日本語</a></li>
<li><a data-lang="es" href="/es/2021.3/Manual/SRPBatcher.html">Español</a></li>
<li><a data-lang="kr" href="/kr/2021.3/Manual/SRPBatcher.html">한국어</a></li>
<li><a data-lang="ru" href="/ru/2021.3/Manual/SRPBatcher.html">Русский</a></li>
</ul></div>
</div>
</div></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar hidden"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc">
<h2>手册</h2>
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2021.3</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2022.1" href="/cn/2022.1/Manual/SRPBatcher.html">2022.1</a></li>
<li class="supported"><a class="docs_version_url_2021.3" href="/cn/2021.3/Manual/SRPBatcher.html">2021.3</a></li>
<li class=""><a class="docs_version_url_2021.2" href="/cn/2021.2/Manual/SRPBatcher.html">2021.2</a></li>
<li class=""><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/SRPBatcher.html">2021.1</a></li>
<li class="supported"><a class="docs_version_url_2020.3" href="/cn/2020.3/Manual/SRPBatcher.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/SRPBatcher.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/SRPBatcher.html">2020.1</a></li>
<li class="supported"><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/SRPBatcher.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/SRPBatcher.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/SRPBatcher.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/SRPBatcher.html">2019.1</a></li>
<li class=""><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/SRPBatcher.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/SRPBatcher.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/SRPBatcher.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/SRPBatcher.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/SRPBatcher.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/SRPBatcher.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/SRPBatcher.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/SRPBatcher.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/SRPBatcher.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>包含此页的版本：</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>不含此页的版本：</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>受支持</li>
<li>
<div class="legacy-box"></div>旧版</li>
</ul>
</div>
</div>
<div class="clear"></div>
</div></div></div></div></div>
<div id="content-wrap" class="content-wrap opened-sidebar"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html">Unity User Manual 2021.3 (LTS)</a></li>
<li><a href="Graphics.html">图形</a></li>
<li><a href="graphics-performance-profiling.html">Graphics performance and profiling</a></li>
<li><a href="optimizing-draw-calls.html">Optimizing draw calls</a></li>
<li>Scriptable Render Pipeline Batcher</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="combining-meshes.html"></a></span><div class="tip">Manually combining meshes</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="RenderingStatistics.html"></a></span><div class="tip">The Rendering Statistics window</div>
</div>
</div></div>
<h1>Scriptable Render Pipeline Batcher</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p>The Scriptable Render Pipeline (SRP) Batcher is a <a href="optimizing-draw-calls.html">draw call optimization</a> that significantly improves performance for applications that use an SRP. The SRP Batcher reduces the CPU time Unity requires to prepare and dispatch draw calls for materials that use the same shader variant. </p>

<figure>
<img src="../uploads/Main/SRPBatcher.png" alt="The Scriptable Render Pipeline (SRP) Batcher reduces the CPU time Unity requires to render scenes with many materials that use the same shader variant.">
<figcaption>The Scriptable Render Pipeline (SRP) Batcher reduces the CPU time Unity requires to render scenes with many materials that use the same shader variant.</figcaption>
</figure>

<h2>Requirements and compatibility</h2>

<p>This section includes information about the render pipeline compatibility of the SRP Batcher.</p>

<h3>Render pipeline compatibility</h3>

<table>
<colgroup>
<col style="text-align:left;">
<col style="text-align:left;">
<col style="text-align:left;">
<col style="text-align:left;">
<col style="text-align:left;">
</colgroup>

<thead>
<tr>
	<th style="text-align:left;"><strong>功能</strong></th>
	<th style="text-align:left;"><strong>内置渲染管线</strong></th>
	<th style="text-align:left;"><strong>通用渲染管线 (URP)</strong></th>
	<th style="text-align:left;"><strong>高清渲染管线 (HDRP)</strong></th>
	<th style="text-align:left;"><strong>Custom Scriptable Render Pipeline (SRP)</strong></th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:left;"><strong>SRP Batcher</strong></td>
	<td style="text-align:left;">否</td>
	<td style="text-align:left;">是</td>
	<td style="text-align:left;">是</td>
	<td style="text-align:left;">是</td>
</tr>
</tbody>
</table>

<p><a name="gameobject-compatibility"></a></p>

<h3>GameObject compatibility</h3>

<p>In any given scene, some GameObjects are compatible with the SRP Batcher, and some aren’t. Compatible GameObjects use the SRP Batcher code path, and non-compatible GameObjects use the standard SRP code path. For more information, see <a href="#how-the-srp-batcher-works">How the SRP Batcher works</a>.</p>

<p>A GameObject must meet the following requirements to be compatible with the SRP Batcher code path:</p>

<ul>
<li>The GameObject must contain either a mesh or a skinned mesh. It can’t be a particle.</li>
<li>The GameObject mustn’t use <a href="../ScriptReference/MaterialPropertyBlock.html">MaterialPropertyBlocks</a>.</li>
<li>The shader that the GameObject uses must be compatible with the SRP Batcher. For more information, see <a href="#shader-compatibility">Shader compatibility</a>.</li>
</ul>

<p><a name="shader-compatibility"></a></p>

<h3>Shader compatibility</h3>

<p>All lit and unlit shaders in the High Definition Render Pipeline (HDRP) and the Universal Render Pipeline (URP) fit this requirement (except for the particle versions of these shaders).</p>

<p>For a custom shader to be compatible with the SRP Batcher it must meet the following requirements:</p>

<ul>
<li>The shader must declare all built-in engine properties in a single constant buffer named <code>UnityPerDraw</code>. For example, <code>unity_ObjectToWorld</code>, or <code>unity_SHAr</code>.</li>
<li>The shader must declare all material properties in a single constant buffer named <code>UnityPerMaterial</code>.</li>
</ul>

<p>You can check the compatibility status of a shader in the Inspector panel. </p>

<figure>
<img src="../uploads/Main/SRP_batcher_shader_compatibility.png" alt="You can check the compatibility of your shaders in the Inspector panel for the specific shader.">
<figcaption>You can check the compatibility of your shaders in the Inspector panel for the specific shader.</figcaption>
</figure>

<h2>使用 SRP Batcher</h2>

<p>This section contains information on how to use the SRP Batcher in Unity’s pre-built Scriptable Render Pipelines.</p>

<h3>Using the SRP Batcher in URP</h3>

<p>要在 URP 中激活 SRP Batcher，请执行以下操作：</p>

<p>1.在 Project 窗口中选择 <a href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@latest/index.html?subfolder=/manual/universalrp-asset.html">URP 资源</a>。
2. In the Inspector for the URP asset, go to <strong>Advanced</strong>, and enable <strong>SRP Batcher</strong>.</p>

<h3>Using the SRP Batcher in HDRP</h3>

<p>When you use HDRP, Unity enables the SRP Batcher by default. Disabling the SRP Batcher is not recommended. However, you can temporarily disable the SRP Batcher for debugging purposes. </p>

<p>To enable and disable the SRP Batcher at build time using the Editor:</p>

<p>1.在 Project 窗口中选择 <a href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.high-definition@latest/index.html?subfolder=/manual/HDRP-Asset.html">HDRP 资源</a>。
2. In the Inspector for the asset, enter <a href="InspectorOptions.html">Debug mode</a>. In Debug mode, you can see the properties of the HDRP Asset, including the SRP Batcher property.
3. Select <strong>Enable</strong> <strong>SRP Batcher</strong> to enable or disable the SRP Batcher.</p>

<p>To enable or disable the SRP Batcher at runtime, toggle the following global variable in your C# code:</p>

<pre><code>GraphicsSettings.useScriptableRenderPipelineBatching = true;
</code></pre>

<p><a name="how-the-srp-batcher-works"></a></p>

<h2>SRP Batcher 的工作原理</h2>

<p>The traditional way to optimize draw calls is to reduce the number of them. Instead, the SRP Batcher reduces render-state changes between draw calls. To do this, the SRP Batcher combines a sequence of <code>bind</code> and <code>draw</code> GPU commands. Each sequence of commands is called an SRP batch.</p>

<figure>
<img src="../uploads/Main/SROShaderPass.png" alt="The batching of bind and draw commands reduces the GPU setup between draw calls.">
<figcaption>The batching of bind and draw commands reduces the GPU setup between draw calls.</figcaption>
</figure>

<p>To achieve optimal performance for your rendering, each SRP batch should contain as many <code>bind</code> and <code>draw</code> commands as possible. To achieve this, use as few shader variants as possible. You can still use as many different materials with the same shader as you want.</p>

<p>When Unity detects a new material during the render loop, the CPU collects all properties and binds them to the GPU in constant buffers. The number of GPU buffers depends on how the shader declares its constant buffers. </p>

<p>The SRP Batcher is a low-level render loop that makes material data persist in GPU memory. If the material content doesn’t change, theSRP Batcher doesn’t make any render-state changes. Instead, the SRP Batcher uses a dedicated code path to update the Unity Engine properties in a large GPU buffer, like this:</p>

<figure>
<img src="../uploads/Main/SRP_Batcher_loop.png" alt="The SRP Batcher rendering workflow. The SRP Batcher uses a dedicated code path to update the Unity Engine properties in a large GPU buffer.">
<figcaption>The SRP Batcher rendering workflow. The SRP Batcher uses a dedicated code path to update the Unity Engine properties in a large GPU buffer.</figcaption>
</figure>

<p>Here, the CPU only handles the Unity Engine properties, labeled <strong>Per Object large buffer</strong> in the above diagram. All materials have persistent constant buffers located in GPU memory, which are ready to use. This speeds up rendering because:</p>

<ul>
<li>All material content now persists in GPU memory.</li>
<li>Dedicated code manages a large per-object GPU constant buffer for all per-object properties.</li>
</ul>

<p><a name="intentionally-removing-compatibility"></a></p>

<h3>Intentionally removing SRP Batcher compatibility for GameObjects</h3>

<p>In some rare cases, you might want to intentionally make particular GameObjects incompatible with the SRP Batcher. For example, if you want to use <a href="GPUInstancing.html">GPU instancing</a>, which isn’t compatible with the SRP Batcher. If you want to render many identical meshes with the exact same material, GPU instancing can be more efficient than the SRP Batcher. To use GPU instancing, you must either:</p>

<ul>
<li>Use <a href="../ScriptReference/Graphics.DrawMeshInstanced.html">Graphics.DrawMeshInstanced</a>.</li>
<li>Manually remove SRP Batcher compatibility and enable GPU instancing for the material.</li>
</ul>

<p>There are two ways to remove compatibility with the SRP Batcher from a GameObject:</p>

<ul>
<li>Make the shader incompatible.</li>
<li>Make the renderer incompatible.</li>
</ul>

<p><strong>Tip</strong>: If you use GPU instancing instead of the SRP Batcher, use the <a href="#Profiler">Profiler</a> to make sure that GPU instancing is more efficient for your application than the SRP Batcher.</p>

<h4>Removing shader compatibility</h4>

<p>You can make both hand-written and Shader Graph shaders incompatible with the SRP Batcher. However, for Shader Graph shaders, if you change and recompile the Shader Graph often, it’s simpler to make the <a href="#removing-renderer-compatibility">renderer incompatible</a> instead. </p>

<p>To make a Unity shader incompatible with the SRP Batcher, you need to make changes to the shader source file:</p>

<ol>
<li>For hand-written shaders, open the shader source file. For Shader Graph shaders, copy the Shader Graph’s compiled shader source code into a new shader source file. Use the new shader source file in your application instead of the Shader Graph.</li>
<li>Add a new <a href="SL-Properties.html">material property</a> declaration into the shader’s <code>Properties</code> block. Don’t declare the new material property in the <code>UnityPerMaterial</code> constant buffer.</li>
</ol>

<p>The material property doesn’t need to do anything; just having a material property that doesn’t exist in the <code>UnityPerMaterial</code> constant buffer makes the shader incompatible with the SRP Batcher.</p>

<p><strong>Warning</strong>: If you use a Shader Graph, be aware that every time you edit and recompile the Shader Graph, you must repeat this process.</p>

<p><a name="removing-renderer-compatibility"></a></p>

<h4>Removing renderer compatibility</h4>

<p>You can make individual renderers incompatible with the SRP Batcher. To do this, add a <code>MaterialPropertyBlock</code> to the renderer.</p>

<h2>Profiling the SRP Batcher in the Unity Frame Debugger</h2>

<p>You can check the status of SRP batches in the <a href="FrameDebugger.html">Frame Debugger</a> window. Each SRP Batch displays how many draw calls Unity used, which keywords Unity attached to the shader, and the reason why Unity didn’t batch that draw call with the previous one.</p>

<p>要检查 SRP Batcher 批次的状态，请执行以下操作：</p>

<ol>
<li>In the Editor, open the Frame Debugger (menu: <strong>Window</strong> &gt; <strong>Analysis</strong> &gt; <strong>Frame Debugger</strong>).</li>
<li>In the Frame Debugger, go to <strong>Render Camera</strong> &gt; <strong>Render Opaques</strong>.</li>
<li>Expand the <strong>RenderLoopNewBatcher.Draw</strong> list.</li>
<li>Select on the <strong>SRP Batch</strong> you want to inspect.</li>
</ol>

<p>In the example below, the reason is: <strong>Nodes have different shaders</strong>. This means that the shader for that SRP batch os different to the one in the previous SRP batch. Because the SRP Batcher used a different shader, the SRP Batcher created a new batch. If several SRP batches have a low number of draw calls, it often means the project uses too many shader variants. </p>

<figure>
<img src="../uploads/Main/SRP_Batcher_batch_information.png" alt="In the Frame Debugger window, you can find details about individual SRP batches, including why the SRP Batcher created a new SRP batch instead of continuing the existing one.">
<figcaption>In the Frame Debugger window, you can find details about individual SRP batches, including why the SRP Batcher created a new SRP batch instead of continuing the existing one.</figcaption>
</figure>

<p>If you write your own Scriptable Render Pipeline, instead of using either the Universal Render Pipeline or the High Definition Render Pipeline, try to write a generic multi-purpose shader with a minimal number of keywords. This is optimal because you can use as many material properties as you want.</p>
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="combining-meshes.html"></a></span><div class="tip">Manually combining meshes</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="RenderingStatistics.html"></a></span><div class="tip">The Rendering Statistics window</div>
</div>
</div>
</div>
<div class="footer-wrapper">
<div class="footer clear">
<div class="copy">Copyright © 2022 Unity Technologies. Publication 2021.3</div>
<div class="menu">
<a href="https://learn.unity.com/">教程</a><a href="https://answers.unity3d.com">社区答案</a><a href="https://support.unity3d.com/hc/en-us">知识库</a><a href="https://forum.unity3d.com">论坛</a><a href="https://unity3d.com/asset-store">Asset Store</a>
</div>
</div>
<div></div>
</div>
</div></div></div>
</div>
</body>
</html>
